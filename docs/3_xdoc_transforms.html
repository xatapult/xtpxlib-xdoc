<?xml version="1.0" encoding="UTF-8"?><html xmlns="http://www.w3.org/1999/xhtml" xmlns:xtlcon="http://www.xtpxlib.nl/ns/container" lang="en" xml:lang="en">
  
  
  
  
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <link rel="stylesheet" href="resources/bootstrap.min.css"/>
    <link rel="stylesheet" href="resources/xtpxlib-moduledoc.css"/>
    <link rel="shortcut icon" href="resources/favicon.ico"/>
    <title>3 xdoc transforms</title>
  </head>
  <body style="padding-top: 65px;"><nav class="navbar fixed-top navbar-expand-sm navbar-dark bg-dark"><a class="navbar-brand" href="index.html" title="home">xtpxlib-xdoc</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"/></button><div id="navbarSupportedContent" class="collapse navbar-collapse"><ul class="navbar-nav mr-auto"><li class="nav-item dropdown"><a href="1_Description.html" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Description <span class="caret"/></a><div class="dropdown-menu"><a href="1_Description.html" class="dropdown-item">Description</a><div class="dropdown-divider"><!----></div><a class="dropdown-item" href="1_Description.html#sect-main-toolchain">The main toolchain</a></div></li><li class="nav-item dropdown"><a href="2_Instructions.html" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Instructions <span class="caret"/></a><div class="dropdown-menu"><a href="2_Instructions.html" class="dropdown-item">Instructions</a><div class="dropdown-divider"><!----></div><a class="dropdown-item" href="2_Instructions.html#d2155e433">Getting started</a><a class="dropdown-item" href="2_Instructions.html#d2155e464">Validation</a><a class="dropdown-item" href="2_Instructions.html#sect-parameter-substitution">Parameter substitution</a><a class="dropdown-item" href="2_Instructions.html#d2155e856">xdoc transforms</a></div></li><li class="nav-item dropdown"><a href="3_xdoc_transforms.html" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">xdoc transforms <span class="caret"/></a><div class="dropdown-menu"><a href="3_xdoc_transforms.html" class="dropdown-item">xdoc transforms</a><div class="dropdown-divider"><!----></div><a class="dropdown-item" href="3_xdoc_transforms.html#d2155e1022">Running an xdoc transform</a><a class="dropdown-item" href="3_xdoc_transforms.html#sect-builtin-xdoc-transformations">Built-in xdoc transformations</a><a class="dropdown-item" href="3_xdoc_transforms.html#sect-write-your-own-transformations">Writing your own xdoc transformations</a></div></li><li class="nav-item dropdown"><a href="4_XProc_Pipelines.html" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">XProc Pipelines <span class="caret"/></a><div class="dropdown-menu"><a href="4_XProc_Pipelines.html" class="dropdown-item">XProc Pipelines</a><div class="dropdown-divider"><!----></div><a class="dropdown-item" href="4_XProc_Pipelines.html#docbook-to-pdf.xpl">XProc (1.0) pipeline: docbook-to-pdf.xpl</a><a class="dropdown-item" href="4_XProc_Pipelines.html#docbook-to-xhtml.xpl">XProc (1.0) pipeline: docbook-to-xhtml.xpl</a><a class="dropdown-item" href="4_XProc_Pipelines.html#xdoc-to-docbook.xpl">XProc (1.0) pipeline: xdoc-to-docbook.xpl</a><a class="dropdown-item" href="4_XProc_Pipelines.html#xdoc-to-pdf.xpl">XProc (1.0) pipeline: xdoc-to-pdf.xpl</a><a class="dropdown-item" href="4_XProc_Pipelines.html#xdoc-to-xhtml.xpl">XProc (1.0) pipeline: xdoc-to-xhtml.xpl</a></div></li><li class="nav-item dropdown"><a href="5_XProc_Libraries.html" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">XProc Libraries <span class="caret"/></a><div class="dropdown-menu"><a href="5_XProc_Libraries.html" class="dropdown-item">XProc Libraries</a><div class="dropdown-divider"><!----></div><a class="dropdown-item" href="5_XProc_Libraries.html#xtpxlib-xdoc.mod.xpl">XProc (1.0) library: xtpxlib-xdoc.mod.xpl</a></div></li><li class="nav-item dropdown"><a href="6_DocBook_dialect.html" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">DocBook dialect <span class="caret"/></a><div class="dropdown-menu"><a href="6_DocBook_dialect.html" class="dropdown-item">DocBook dialect</a><div class="dropdown-divider"><!----></div><a class="dropdown-item" href="6_DocBook_dialect.html#d2155e2523">Supported root elements</a><a class="dropdown-item" href="6_DocBook_dialect.html#sect-docbook5">Document information</a><a class="dropdown-item" href="6_DocBook_dialect.html#d2155e2566">Chapter/Section structure</a><a class="dropdown-item" href="6_DocBook_dialect.html#d2155e2602">Block constructions</a><a class="dropdown-item" href="6_DocBook_dialect.html#d2155e3050">Inline elements</a><a class="dropdown-item" href="6_DocBook_dialect.html#d2155e3608">Other constructs</a><a class="dropdown-item" href="6_DocBook_dialect.html#sect-fixed-width-column-mechanism">Fixed-width column mechanism</a></div></li><li class="nav-item"><a class="nav-link" href="resources/xtpxlib-xdoc-documentation.pdf" title="PDF version of this documentation site">PDF</a></li></ul></div></nav><div class="container"><a name="chapter-xdoc-transforms"><!----></a><div class="page-header" style="padding-top: 65px; margin-top: -65px;"><h1 class="chapter"><span class="chapter-number">3 </span><code class="code">xdoc</code> transforms</h1></div><p class="para">An <code class="code">xdoc</code> transform is an XSLT stylesheet or XProc (1.0) pipeline that is triggered from your source document and inserts generated
    DocBook contents. There are several of these <a href="#sect-builtin-xdoc-transformations"><span class="link">transforms built into the
        <code class="code">xtpxlib-xdoc</code> component</span></a> but its also easy to <a href="#sect-write-your-own-transformations"><span class="link">write one of your
      own</span></a>.</p><div class="sect1" id="d2155e1022"><a name="d2155e1022"><!----></a><h2 class="sect1" style="padding-top: 65px; margin-top: -65px;"><span class="sect1-number">3.1</span> Running an <code class="code">xdoc</code> transform</h2><p class="para">The <code class="tag">&lt;xdoc:transform&gt;</code>extension element runs an <code class="code">xdoc</code> transformation (either XProc (1.0) or XSLT (2.0 or 3.0)). It is
      completely replaced by the outcome of the transformation.</p><div class="programlisting"><pre class="programlisting">&lt;xdoc:transform href = xs:anyURI
                (any)? &gt;
  &lt;!-- (Optional) XML to transform and/or an &lt;xi:include&gt; element to load this from an external source. --&gt;
&lt;/xdoc:transform&gt;</pre></div><p class="para" style="font-size: 50%;"> </p><div class="table"><table class="table table-sm table-bordered"><thead class="thead-light"><tr><th>Attribute</th><th>#</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code class="code">href</code></td><td>1</td><td><code class="code">xs:anyURI</code></td><td>Reference to the actual transformation. Relative names are resolved against the location of the source document.<br/>This file's extension determines whether an XProc 1.0 (extension: <code class="code">.xpl</code>) or an XSLT (extension: <code class="code">.xsl</code>) is
        done.<br/>A value that starts with <code class="code">$xdoc</code> is assumed to be an <code class="code">xtpxlib-xdoc</code> built-in transformation (e.g.
          <code class="code">href="$xdoc/code-docgen.xpl"</code>). See also <a href="#sect-builtin-xdoc-transformations" class="xref">3.2 Built-in xdoc transformations</a>.</td></tr><tr><td><code class="code">(any)</code></td><td>?</td><td/><td>Often transformations specify additional attributes on the <code class="tag">&lt;xdoc:transform&gt;</code> element to parametrize their functionality. Any
        additional attribute is allowed here.</td></tr></tbody></table></div></div><div class="sect1" id="sect-builtin-xdoc-transformations"><a name="sect-builtin-xdoc-transformations"><!----></a><h2 class="sect1" style="padding-top: 65px; margin-top: -65px;"><span class="sect1-number">3.2</span> Built-in <code class="code">xdoc</code> transformations</h2><p class="para">The <code class="code">xtpxlib-xdoc</code> has several transforms built in. You can easily reference these by prefixing their name with
        <code class="code">$xdoc</code>, for instance <code class="code">$xdoc/code-docgen.xpl</code>.</p><div class="table"><table class="table table-sm table-bordered"><thead class="thead-light"><tr><th>Module</th><th>Description</th></tr></thead><tbody><tr><td><code class="code"><a href="#code-docgen-dir.xpl"><span class="link">code-docgen-dir.xpl</span></a></code></td><td>Runs the <code class="code"><a href="#code-docgen.xpl"><span class="link">$xdoc/code-docgen.xpl</span></a></code> transform over multiple files in a directory.</td></tr><tr><td><code class="code"><a href="#code-docgen.xpl"><span class="link">code-docgen.xpl</span></a></code></td><td>Takes an XML document (XSL, XSD, XProc, ordinary XML) and generates documentation out of it.</td></tr><tr><td><code class="code"><a href="#include-docbook.xpl"><span class="link">include-docbook.xpl</span></a></code></td><td>Takes an XML document and unwraps the root element from it. It then copies all the children to the output, with the exception of any <code class="code">db:info</code> elements.</td></tr><tr><td><code class="code"><a href="#xml-description.xpl"><span class="link">xml-description.xpl</span></a></code></td><td>Takes a document that <span class="emphasis italic">describes</span> an XML document, using special markup for this, and turns this into DocBook.</td></tr></tbody></table></div><div class="sect2" id="code-docgen-dir.xpl"><a name="code-docgen-dir.xpl"><!----></a><h3 class="sect2" style="padding-top: 65px; margin-top: -65px;"><span class="sect2-number">3.2.1</span> XProc (1.0) pipeline: <code class="code">code-docgen-dir.xpl</code></h3><p class="para">File: <code class="code">transforms/code-docgen-dir.xpl</code></p><p class="para">Runs the <code class="code"><a href="#code-docgen.xpl"><span class="link">$xdoc/code-docgen.xpl</span></a></code> transform over multiple files in a directory.</p><p class="para">Typical usage (within an <code class="code">xdoc</code> source document):</p><div class="programlisting"><pre class="programlisting">&lt;xdoc:transform href="$xdoc/code-docgen-dir.xpl"
   dir="…"
   depth="…"
   filter="…"
   toc-only="…" /&gt;</pre></div><ul class="itemizedlist"><li><p class="para"><code class="code">@dir</code>: Directory to process</p></li><li><p class="para"><code class="code">@depth</code>: (integer, default -1) The depth in traversing the directory tree.</p><ul class="itemizedlist"><li><p class="para">When le 0, <code class="code">@dir</code> and all its subdirectories are processed.</p></li><li><p class="para">When eq 1, only <code class="code">@dir</code> is processed.</p></li><li><p class="para">When gt 1, the sub-directories up to this depth are processed.</p></li></ul></li><li><p class="para"><code class="code">@filter</code>: optional regexp filter (e.g. get only XProc files with <code class="code">filter="\.xpl$"</code>)</p></li><li><p class="para"><code class="code">@toc-only</code>: (boolean, default <code class="code">false</code>) Whether to produce a ToC table only.</p></li></ul><p class="para">All (other) attributes are passed to <code class="code">code-docgen.xpl</code>.</p><div class="table"><table class="table table-sm table-bordered"><thead class="thead-light"><tr><th>Port</th><th>Type</th><th>Primary?</th><th>Description</th></tr></thead><tbody><tr><td><code class="code">source</code></td><td>in</td><td>yes</td><td>The triggering <code class="code">xdoc:transform</code> element.</td></tr><tr><td><code class="code">result</code></td><td>out</td><td>yes</td><td>The resulting DocBook output.</td></tr></tbody></table></div></div><div class="sect2" id="code-docgen.xpl"><a name="code-docgen.xpl"><!----></a><h3 class="sect2" style="padding-top: 65px; margin-top: -65px;"><span class="sect2-number">3.2.2</span> XProc (1.0) pipeline: <code class="code">code-docgen.xpl</code></h3><p class="para">File: <code class="code">transforms/code-docgen.xpl</code></p><p class="para">Type: <code class="code">xdoc:code-docgen</code></p><p class="para">Takes an XML document (XSL, XSD, XProc, ordinary XML) and generates documentation out of it.</p><p class="para">Typical usage (within an <code class="code">xdoc</code> source document):</p><div class="programlisting"><pre class="programlisting">&lt;xdoc:transform href="$xdoc/code-docgen.xpl"
   filecomponents="…"
   header-level="…"
   add-table-titles="…"
   sublevels="…"
   id="…" &gt;
  &lt;xi:include href="path/to/document/to/generate/documentation/for"/&gt;
&lt;/xdoc:transform&gt;</pre></div><ul class="itemizedlist"><li><p class="para"><code class="code">@filecomponents</code>: (integer, default 0)Determines the display of the filename:</p><ul class="itemizedlist"><li><p class="para">When lt 0, no filename is displayed</p></li><li><p class="para">When eq 0, the full filename (with full path) is displayed</p></li><li><p class="para">When gt 0, this number of filename components is displayed. So 1 means filename only, 2 means filename and direct foldername, etc.</p></li></ul></li><li><p class="para"><code class="code">@header-level</code>: (integer, default 0)Determines what kind of DocBook section is created:</p><ul class="itemizedlist"><li><p class="para">When le 0, no separate section is created, all titles will be output as <code class="code">bridgehead</code> elements.</p></li><li><p class="para">Otherwise a title with this level is created (e.g. <code class="code">header-level="1"</code> means a <code class="code">sect1</code> element).</p></li></ul></li><li><p class="para"><code class="code">@add-table-titles</code>: (boolean, default <code class="code">false</code>) Whether to add titles to generated tables.</p></li><li><p class="para"><code class="code">@sublevels</code>: (boolean, default <code class="code">true</code>) If true only the main section will be a "real" section. All sublevels will become bridgeheads.</p></li><li><p class="para"><code class="code">@id</code>: Optional identifier of this section. If absent the id will become the document's filename.</p></li></ul><p class="para">If the format to document has means to add documentation of itself (like XProc (<code class="code">p:documentation</code>) or XML Schema (<code class="code">xs:annotation</code>)), this is used. If there is no such thing (like for XSLT and straight XML), comments starting with a tilde (<code class="code">~</code>) are used.</p><p class="para">All descriptions and documentation sections can contain simple Markdown.</p><p class="para">The following formats are supported</p><ul class="itemizedlist"><li><p class="para">XML documents: only the header comment is used.</p></li><li><p class="para">XSLT (2.0 and 3.0) stylesheets: document all <span class="emphasis italic">exported</span> parameters, variables, functions and named templates. Something is supposed to be for export if its <span class="emphasis italic">not</span> in the no or local namespace.</p></li><li><p class="para">XProc pipelines and libraries</p></li><li><p class="para">XML Schemas: Uses the global annotation and lists the global elements using their annotations.</p></li></ul><div class="table"><table class="table table-sm table-bordered"><thead class="thead-light"><tr><th>Port</th><th>Type</th><th>Primary?</th><th>Description</th></tr></thead><tbody><tr><td><code class="code">source</code></td><td>in</td><td>yes</td><td>The document to generate documentation for, wrapped in an <code class="code">xdoc:transform</code> element.</td></tr><tr><td><code class="code">result</code></td><td>out</td><td>yes</td><td>The resulting DocBook output.</td></tr></tbody></table></div></div><div class="sect2" id="include-docbook.xpl"><a name="include-docbook.xpl"><!----></a><h3 class="sect2" style="padding-top: 65px; margin-top: -65px;"><span class="sect2-number">3.2.3</span> XProc (1.0) pipeline: <code class="code">include-docbook.xpl</code></h3><p class="para">File: <code class="code">transforms/include-docbook.xpl</code></p><p class="para">Takes an XML document and unwraps the root element from it. It then copies all the children to the output, with the exception of any <code class="code">db:info</code> elements.</p><p class="para">It is the responsibility of the author to make sure that everything that results is in the DocBook (<code class="code">http://docbook.org/ns/docbook</code>) namespace!</p><p class="para">Typical usage (within an <code class="code">xdoc</code> source document):</p><div class="programlisting"><pre class="programlisting">&lt;xdoc:transform href="$xdoc/include-docbook.xpl&gt;
  &lt;xi:include href="path/to/xml/to/include.xml"/&gt;
&lt;/xdoc:transform&gt;</pre></div><div class="table"><table class="table table-sm table-bordered"><thead class="thead-light"><tr><th>Port</th><th>Type</th><th>Primary?</th><th>Description</th></tr></thead><tbody><tr><td><code class="code">source</code></td><td>in</td><td>yes</td><td>The document containing the parts to include, wrapped in an <code class="code">xdoc:transform</code> element.</td></tr><tr><td><code class="code">result</code></td><td>out</td><td>yes</td><td>The resulting DocBook output.</td></tr></tbody></table></div></div><div class="sect2" id="xml-description.xpl"><a name="xml-description.xpl"><!----></a><h3 class="sect2" style="padding-top: 65px; margin-top: -65px;"><span class="sect2-number">3.2.4</span> XProc (1.0) pipeline: <code class="code">xml-description.xpl</code></h3><p class="para">File: <code class="code">transforms/xml-description.xpl</code></p><p class="para">Takes a document that <span class="emphasis italic">describes</span> an XML document, using special markup for this, and turns this into DocBook.</p><p class="para">A schema for this markup format can be found in <code class="code">xsd/element-description.xml</code>.</p><p class="para">Typical usage (within an <code class="code">xdoc</code> source document):</p><div class="programlisting"><pre class="programlisting">&lt;xdoc:transform href="$xdoc/xml-description.xpl&gt;
  &lt;xi:include href="path/to/xml/description.xml"/&gt;
&lt;/xdoc:transform&gt;</pre></div><div class="table"><table class="table table-sm table-bordered"><thead class="thead-light"><tr><th>Port</th><th>Type</th><th>Primary?</th><th>Description</th></tr></thead><tbody><tr><td><code class="code">source</code></td><td>in</td><td>yes</td><td>The document containing the XML description, wrapped in an <code class="code">xdoc:transform</code> element.</td></tr><tr><td><code class="code">result</code></td><td>out</td><td>yes</td><td>The resulting DocBook output.</td></tr></tbody></table></div></div></div><div class="sect1" id="sect-write-your-own-transformations"><a name="sect-write-your-own-transformations"><!----></a><h2 class="sect1" style="padding-top: 65px; margin-top: -65px;"><span class="sect1-number">3.3</span> Writing your own <code class="code">xdoc</code> transformations</h2><ul class="itemizedlist"><li><p class="para">To add an <code class="code">xdoc</code> transform of your own you need to write an XSLT stylesheet or an XProc pipeline.</p></li><li><p class="para">Such a stylesheet or transformation gets the *full* <code class="tag">&lt;xdoc:transform&gt;</code> element as its input. It can inspect the
            <code class="tag">&lt;xdoc:transform&gt;</code> root element itself for its attributes.</p></li><li><p class="para">The output of the stylesheet/pipeline must be the resulting (valid!) DocBook.</p></li><li><p class="para">If the resulting DocBook contains multiple elements you can wrap them all in an <code class="tag">&lt;xdoc:GROUP&gt;</code> element to make the result a
          single well-formed document. The <code class="tag">&lt;xdoc:GROUP&gt;</code> wrapper is removed later on by the <code class="code">xdoc</code> processing.</p></li><li><p class="para">You must reference your stylesheet or pipeline using <code class="tag">&lt;xdoc:transform&gt;</code>'s <code class="code">href</code> attribute.</p></li></ul><p class="para">Here is a simple example of something that is actually quite useful. Tables in DocBook are complex things. When you to have format the same
      kind of data over and over again in a table, it becomes very boring and hard to keep consistent and maintainable. Using <code class="code">xdoc</code>
      transforms you can automate the data to DocBook part.</p><p class="para">Assume we have, all over the document, weather data, that comes in this source format:</p><div class="programlisting"><pre class="programlisting">&lt;weather-data&gt;
  &lt;data city="Amsterdam" temp="20"/&gt;
  &lt;data city="Stavanger" temp="-5"/&gt;
&lt;/weather-data&gt;</pre></div><p class="para">You want to show this as tables. The following XSLT stylesheet (called <code class="code">transform-weather-data.xsl</code>) will
      do the <code class="code">xdoc</code> transform trick. As its input it gets the weather data wrapped in the <code class="tag">&lt;xdoc:transform&gt;</code> element (see below).</p><div class="programlisting"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="3.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
  xmlns:xdoc="http://www.xtpxlib.nl/ns/xdoc"
  xmlns="http://docbook.org/ns/docbook"&gt;

  &lt;xsl:template match="/"&gt;
    &lt;table&gt;
      &lt;title&gt;Example weather data&lt;/title&gt;
      &lt;tgroup cols="2"&gt;
        &lt;colspec colwidth="4cm"/&gt;
        &lt;colspec/&gt;
        &lt;thead&gt;
          &lt;row&gt;
            &lt;entry&gt;
              &lt;para&gt;City&lt;/para&gt;
            &lt;/entry&gt;
            &lt;entry&gt;
              &lt;para&gt;Temperature (C)&lt;/para&gt;
            &lt;/entry&gt;
          &lt;/row&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
          &lt;xsl:for-each select="/xdoc:transform/weather-data/data"&gt;
            &lt;row&gt;
              &lt;entry&gt;
                &lt;para&gt;
                  &lt;xsl:value-of select="@city"/&gt;
                &lt;/para&gt;
              &lt;/entry&gt;
              &lt;entry&gt;
                &lt;para&gt;&lt;xsl:value-of select="@temp"/&gt;&lt;/para&gt;
              &lt;/entry&gt;
            &lt;/row&gt;
          &lt;/xsl:for-each&gt;
        &lt;/tbody&gt;
      &lt;/tgroup&gt;
    &lt;/table&gt;
  &lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;</pre></div><p class="para">In your document you add:</p><div class="programlisting"><pre class="programlisting">&lt;xdoc:transform href="path/to/transform-weather-data.xsl"&gt;
  &lt;xi:include href="path/to/your/weather/data.xml"/&gt;
&lt;/xdoc:transform&gt;</pre></div><p class="para">And the result for this example is:</p><div class="table"><table class="table table-sm table-bordered"><thead class="thead-light"><tr><th>City</th><th>Temperature (C)</th></tr></thead><tbody><tr><td>Amsterdam</td><td>20</td></tr><tr><td>Stavanger</td><td>-5</td></tr></tbody></table></div></div></div><script src="resources/jquery-3.4.1.slim.min.js"><!--  --></script><script src="resources/popper.min.js"><!--  --></script><script src="resources/bootstrap.min.js"><!--  --></script></body>
</html>